From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: booky10 <boooky10@gmail.com>
Date: Mon, 17 Jul 2023 18:10:28 +0200
Subject: [PATCH] Fix cancelling spectate event not doing anything


diff --git a/src/main/java/net/minecraft/server/level/ServerPlayer.java b/src/main/java/net/minecraft/server/level/ServerPlayer.java
index 0b807c4de22bb2320ea9767d2accd7fb0bf80820..ea42ab876921255021430534fd8bf57a0931ba8c 100644
--- a/src/main/java/net/minecraft/server/level/ServerPlayer.java
+++ b/src/main/java/net/minecraft/server/level/ServerPlayer.java
@@ -2135,11 +2135,13 @@ public class ServerPlayer extends Player {
             if (this.camera == this) {
                 com.destroystokyo.paper.event.player.PlayerStopSpectatingEntityEvent playerStopSpectatingEntityEvent = new com.destroystokyo.paper.event.player.PlayerStopSpectatingEntityEvent(this.getBukkitEntity(), entity1.getBukkitEntity());
                 if (!playerStopSpectatingEntityEvent.callEvent()) {
+                    this.camera = entity1; // CloudPlane
                     return;
                 }
             } else {
                 com.destroystokyo.paper.event.player.PlayerStartSpectatingEntityEvent playerStartSpectatingEntityEvent = new com.destroystokyo.paper.event.player.PlayerStartSpectatingEntityEvent(this.getBukkitEntity(), entity1.getBukkitEntity(), entity.getBukkitEntity());
                 if (!playerStartSpectatingEntityEvent.callEvent()) {
+                    this.camera = entity1; // CloudPlane
                     return;
                 }
             }
